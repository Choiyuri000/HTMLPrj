<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>board/commentList.html</title>
<script>
	window.onload = function() {
		loadCommentList();

	}
	//목록조회
	function loadCommentList() {
		let xhtp = new XMLHttpRequest();
		xhtp.open('get', '../CommentsServlet?cmd=selectAll');
		xhtp.send();
		xhtp.onload = loadCommentResult;
	}
	// 목록조회 콜백.
	function loadCommentResult() {
		let xmlDoc = this.responseXML;
		let code = xmlDoc.getElementsByTagName('code')[0].innerHTML;
		if (code == 'success') {
			let commentList = xmlDoc.getElementsByTagName('row');
			let listDiv = document.getElementById('commentList');
			for (let i = 0; i < commentList.length; i++) {
				let commentDiv = makeCommentView(commentList[i]);
				listDiv.appendChild(commentDiv);
			}
		} else if (code == 'error') {
			let msg = xmlDoc.getElementsByTagName('data')[0].innerHTML;
			window.alert(msg);
		}
	}
	function makeCommentView(comment) {
		let div = document.createElement('div');
		let id = comment.children[0].innerHTML;
		div.setAttribute('id', id);
		let str = '<strong>' + comment.children[1].innerHTML + '</strong>'
				+ comment.children[2].innerHTML
				+ '<input type="button" value="수정" onclick="viewUpdateForm('
				+ id + ')">'
				+ '<input type="button" value="삭제" onclick="confirmDelete()">';
		div.innerHTML = str;
		return div;
	}
	// 글 등록
	function addComment() {
		let name = document.addForm.name.value;
		let content = document.addForm.content.value;
		if (name == "") {
			alert('이름을 입력하세요!');
			document.addForm.name.focus();
			return;
		} else if (content == "") {
			alert('내용을 입력하세요!');
			document.addForm.content.focus();
			return;
		}
		let url = '../CommentsServlet?cmd=insert&name=' + name + '&content='
				+ content;
		let xhtp = new XMLHttpRequest();
		xhtp.open('get', url);
		xhtp.send();
		xhtp.onload = addResult;
	}

	//댓글 등록 입력
	function addResult() {
		let xmlDoc = this.responseXML;
		console.log(xmlDoc);
		let code = xmlDoc.getElementsByTagName('code')[0].innerHTML;
		console.log(code);
		if (code == 'success') {
			let listDiv = document.getElementById('commentList');
			let comment = xmlDoc.getElementsByTagName('data')[0];
			let commentDiv = makeCommentView(comment);
			listDiv.appendChild(commentDiv);

		} else if (code == 'error') {
			let listDiv = document.getElementById('commentList');
			let comment = xmlDoc.getElementsByTagName('data')[0];
			let commentDiv = makeCommentView(comment);
			listDiv.appendChild(commentDiv);
		}

	}
	// 수정버튼 클릭시
	function viewUpdateView(id) {
		let updateFormDiv = document.getElementById('commentUpdate');
		let commentDiv = document.getElementById(id);
		console.log(commentDiv);
	}
</script>
</head>
<body>
	<!--댓글목록  -->
	<div id='commentList'></div>

	<!--댓글등록화면 -->
	<div id='commentAdd'>
		<form name='addForm' action="">
			이름: <input type="text" name="name" size='10'><br> 내용:
			<textarea name="content" cols="20" rows="3"></textarea>
			<br> <input type="button" value="등록" onclick="addComment()"><br>
		</form>
	</div>
	<!--댓글수정화면  -->
	<div id="commentUpdate" style="display: none;">
		<form name="updateForm" action="">
			<input type="hidden" name="id"> 이름: <input type="text"
				name="name" size="10"><br> 내용:
			<textarea name="content" rows="3" cols="3"></textarea>
			<br> <input type="button" value="변경" onclick="updateComment()">
			<input type="button" value="취소" onclick="cancelUpdate()">
		</form>
	</div>
</body>
</html>